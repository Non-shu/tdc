<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.repository.mybatis.ApprovalDocumentMapper">

  <resultMap id="DocMap" type="ApprovalDocumentVO">
    <id     property="docId"    column="doc_id"/>
    <result property="formId"    column="form_id"/>
    <result property="title"     column="title"/>
    <result property="content"   column="content"/>
    <result property="status"    column="status"
            javaType="com.example.demo.domain.ApprovalStatus"/>
    <result property="createdBy" column="created_by"/>
    <result property="createdAt" column="created_at"/>
  </resultMap>

  <insert id="insert" useGeneratedKeys="true" keyProperty="docId">
    INSERT INTO approval_document (form_id, title, content, status, created_by)
    VALUES (#{formId}, #{title}, #{content}, #{status}, #{createdBy})
  </insert>

  <select id="findById" resultMap="DocMap">
    SELECT * FROM approval_document WHERE doc_id = #{id}
  </select>

  <select id="findMyDrafts" resultMap="DocMap">
    SELECT *
      FROM approval_document
     WHERE created_by = #{userId}
       AND status = 'DRAFT'
     ORDER BY doc_id DESC
  </select>

  <select id="findByStatus" resultMap="DocMap">
    SELECT *
      FROM approval_document
     WHERE created_by = #{userId}
       AND status = #{status}
     ORDER BY doc_id DESC
  </select>

</mapper>
