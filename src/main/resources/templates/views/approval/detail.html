<div class="row g-4">

  <!-- 본문 영역 -->
  <div class="col-12 col-xl-9">
    <!-- 본문 -->
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h5 class="mb-3" th:text="${header != null ? header['title'] : '제목 없음'}">제목</h5>

        <!-- 저장된 HTML -->
        <div id="docBody" class="border rounded p-3"
             th:utext="${header != null ? header['contentHtml'] : ''}">
          본문 HTML
        </div>
      </div>
    </div>

    <!-- 첨부 -->
    <div class="card shadow-sm">
      <div class="card-header">첨부파일</div>
      <div class="card-body">
        <ul class="list-group" th:if="${attachments != null and !#lists.isEmpty(attachments)}">
          <li class="list-group-item d-flex justify-content-between align-items-center"
              th:each="a : ${attachments}">
            <div class="text-truncate">
              <a th:href="@{|/files/download/${a.attId}|}" th:text="${a.filename}" class="text-decoration-none">filename</a>
              <small class="text-body-secondary ms-2" th:text="${a.contentType}">type</small>
              <small class="text-body-secondary ms-1"
                     th:text="${#numbers.formatInteger((a.size ?: 0)/1024,0)} + ' KB'">size</small>
            </div>
            <a class="btn btn-sm btn-outline-primary" th:href="@{|/files/inline/${a.attId}|}" target="_blank">새창</a>
          </li>
        </ul>
        <div class="text-body-secondary" th:if="${attachments == null or #lists.isEmpty(attachments)}">첨부 없음</div>
      </div>
    </div>
  </div>

  <!-- 사이드(고정) -->
  <aside class="col-12 col-xl-3">
    <div class="sticky-aside" style="position:sticky;top:84px;">

      <!-- 문서 정보 + 액션 -->
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          문서 정보
          <div class="d-flex gap-2">
            <button type="button" class="btn btn-primary btn-sm"
                    id="btnApprove" th:attr="data-docid=${docId}"
                    th:disabled="${!(canAct ?: false)}">승인</button>
            <button type="button" class="btn btn-outline-danger btn-sm"
                    id="btnReject" th:attr="data-docid=${docId}"
                    th:disabled="${!(canAct ?: false)}">반려</button>
          </div>
        </div>
        <div class="card-body small">
          <div class="d-flex justify-content-between"><span>문서 ID</span><span th:text="${docId}">-</span></div>
          <div class="d-flex justify-content-between"><span>기안자</span>
            <span th:text="${header != null ? header['drafter_name'] : '-'}">-</span></div>
          <div class="d-flex justify-content-between"><span>작성일</span>
            <span th:text="${header != null && header['created_at'] != null
                           ? #temporals.format(header['created_at'],'yyyy-MM-dd HH:mm')
                           : '-'}">-</span></div>
          <div class="d-flex justify-content-between"><span>상태</span>
            <span class="badge text-bg-secondary"
                  th:text="${header != null ? header['status'] : '-'}">-</span></div>
          <hr>
          <div class="d-flex justify-content-between"><span>결재 가능</span>
            <span th:text="${(canAct ?: false)} ? '예' : '아니오'">-</span></div>
        </div>

        <!-- CSRF(널가드) -->
        <input type="hidden" id="csrfHeader" th:value="${_csrf != null ? _csrf.headerName : ''}">
        <input type="hidden" id="csrfToken"  th:value="${_csrf != null ? _csrf.token      : ''}">
      </div>

      <!-- 결재선 -->
      <div class="card">
        <div class="card-header">결재선</div>
        <div class="card-body p-0">
          <table class="table table-hover mb-0 align-middle">
            <thead class="table-light">
            <tr>
              <th style="width:70px;">단계</th>
              <th>결재자</th>
              <th style="width:110px;">상태</th>
              <th style="width:160px;">처리시각</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="l : ${lines}">
              <td th:text="${l.stepNo}">1</td>
              <td th:text="${l.approverName}">홍길동</td>
              <td th:text="${l.stepStatus}">SUBMIT</td>
              <td th:text="${l.actedAt} ?: '-'">-</td>
            </tr>
            <tr th:if="${lines == null or #lists.isEmpty(lines)}">
              <td colspan="4" class="text-center text-body-secondary py-4">결재선 정보가 없습니다.</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </aside>
</div>
